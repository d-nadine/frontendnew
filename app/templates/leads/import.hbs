<div class="tab-pane active">
  {{#unless importing}}
    <div class="alert alert-info">
      <i class="ss-standard ss-info"></i> Import your own contacts by uploading a CSV file. Need more guidance? <a href="#" {{action "toggleInstructions"}}>Click here</a> for some basic tips.
    </div>
    {{#if showInstructions}}
      <div class="well">
        <h4>Import instructions</h4>
        <p>
          <ol>
            <li>Download our sample file <a href="https://s3.amazonaws.com/radium-production/static/sample.csv" target="_blank">here</a></li>
            <li>Use a CSV file from either Microsoft Excel or Google Spreadsheets</li>
            <li>If you are having trouble with characters showing up strangely be sure to set the CSV encoding to UTF-8</li>
            <li>For large uploads please click the "?" at the bottom right to ask for assistance</li>
          </ol>
        </p>
        <button class="btn btn-main btn-primary" {{action "toggleInstructions"}}>
          Thanks, got it
        </button>
      </div>
    {{/if}}
    {{#if isUploading}}
      {{partial 'is_loading'}}
    {{/if}}
    {{#if initialImported}}
      <div class="form form-horizontal well main-form import-match-form">
        <fieldset>
          <div class="match-columns-title">
            <div class="preview-title">Preview</div>
          </div>
          <div class="control-group">
            <label class="control-label">First Row is Header</label>
            <div class="controls">
              {{check-box checked=firstRowIsHeader class="checker-block"}}
            </div>
          </div>
          <h4>Contact Name</h4>
          {{import-header leader="First Name" source=headerData value=headerInfo.firstName row=firstDataRow}}
          {{import-header leader="Last Name" source=headerData value=headerInfo.lastName row=firstDataRow}}
          <h4>Or</h4>
          {{import-header leader="Whole Name" source=headerData value=headerInfo.name row=firstDataRow class="match-divider"}}
          {{import-header leader="Company Name" source=headerData value=headerInfo.companyName row=firstDataRow class="match-divider"}}
          {{import-header leader="Email" source=headerData value=headerInfo.email row=firstDataRow}}
          {{import-header leader="Phone Number" source=headerData value=headerInfo.phone row=firstDataRow class="match-divider"}}
          {{import-header leader="Street" source=headerData value=headerInfo.street row=firstDataRow}}
          {{import-header leader="City" source=headerData value=headerInfo.city row=firstDataRow}}
          {{import-header leader="State" source=headerData value=headerInfo.state row=firstDataRow}}
          {{import-header leader="Zipcode" source=headerData value=headerInfo.zip row=firstDataRow}}
          {{import-header leader="Country" source=headerData value=headerInfo.country row=firstDataRow}}
        </fieldset>
        <fieldset>
          <legend>Combine additional fields into about field or create tag from field.</legend>
          {{multi-importfields fields=additionalFields addNew="addNewAdditionalField" removeField="removeAdditionalField" headerData=headerData firstDataRow=firstDataRow}}
        </fieldset>

        {{#if selectedHeaders.length}}
        <h4>Showing a sample of {{previewData.length}} rows for <code>{{importFile.name}}</code>.</h4>
        <div class="preview">
          <table class="table table-bordered table-striped table-hover">
            <thead>
              <tr>
                {{#each selectedHeaders}}
                  <th>{{name}}</th>
                {{/each}}
              </tr>
            </thead>
            <tbody>
              {{#each previewData}}
                <tr>
                  {{#each field in fields}}
                    <td>{{field}}</td>
                  {{/each}}
                </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
        {{/if}}
        <fieldset>
          <h4>Type</h4>
          <div class="control-group radio-group">
            <ul>
              {{view Radium.Radiobutton selectedValueBinding="controller.status" name="type" leader="Lead" value="pipeline" tagName="li"}}
              {{view Radium.Radiobutton selectedValueBinding="controller.status" name="type" leader="Exclude From Pipeline" value="exclude" tagName="li"}}
            </ul>
            {{view view.tags}}
          </div>
        </fieldset>
        <div class="button-row">
          <button {{action "importContacts"}} {{bind-attr disabled=isSaving}} class="btn btn-primary btn-large pull-right">
            {{#if isSaving}}
              <img src="/images/loading/ajax-loader.gif"/> <span class="muted">Importing</span>
            {{else}}
              <i class="ss-standard ss-plus"></i> Import
            {{/if}}
          </button>
          <button {{action "reset"}} {{bind-attr disabled=isSaving}} class="btn btn-primary btn-large pull-left">
            Cancel
          </button>
        </div>
      </div>
    {{else}}
      <div class="form form-horizontal well main-form new-lead-form">
        <div class="control-group">
          {{drag-csv cancel="cancelImport" disabled=disableImport isUploading=isUploading finished="initialFileUploaded"}}
          <span class="text-center help-block">Download sample file for quicker import <a href="https://s3.amazonaws.com/radium-production/static/sample.csv" target="_blank">here</a></span>
        </div>
        <div class="control-group text-right">
          <div class="btn btn-main btn-file-upload">
            <span>
              <i class="ss-symbolicons-block ss-addfile"></i>
              Upload CSV file
            </span>
            {{csv-reader cancel="cancelImport" disabled=disableImport isUploading=isUploading finished="initialFileUploaded"}}
          </div>
        </div>
      </div>
    {{/if}}
  {{/unless}}
  {{#if importing}}
    <div class="well">
      <h4>Importing contacts from <code>{{importFile.name}}</code></h4>
      {{view Radium.ProgressBar percentageBinding="percentage"}}
      <h5>It is safe to navigate away or close the browser.  The import will complete.</h5>
    </div>
  {{/if}}
  <fieldset>
    <legend>Previous Contact Imports</legend>
    {{#if model.isUpdating}}
      {{partial 'is_loading'}}
    {{else}}
      <table class="table table-striped table-bordered table-hover attachments">
        <thead>
          <tr>
            <th>File Name</th>
            <th>Imported On</th>
            <th>Imported</th>
            <th>Errors</th>
            <th>Status</th>
            <th>&nbsp;</th>
          </tr>
        </thead>
        <tbody>
          {{#each sortedJobs itemController="importJobsItem"}}
            <tr>
              <td>{{fileName}}</td>
              <td>{{formatDateTime createdAt format="full"}}</td>
              <td>{{importedCount}}</td>
              <td class="center">{{importErrors.length}}</td>
              <td {{bind-attr class="importStatus"}}>
                {{#if completedWithErrors}}
                  Finished with errors <br/>
                  <a href="#" {{action "toggleErrors"}}>
                    {{linkText}}
                  </a>
                {{else}}
                  {{capitalize importStatus}}
                {{/if}}
              </td>
              <td>
                {{#if isFinished}}
                  <button type="button" {{action "confirmDeleteJob" this}} {{bind-attr disabled="isDeleting"}} class="close">
                    <i class="ss-standard ss-delete"></i>
                  </button>
                {{/if}}
              </td>
            </tr>
            {{#if showErrors}}
              <tr>
                <td colspan="4">
                  <table class="table table-striped table-bordered table-hover attachments">
                    <thead>
                      <tr>
                        <th>Row</th>
                        <th>Error Message</th>
                        <th>CSV Row</th>
                      </tr>
                    </thead>
                    <tbody>
                      {{#each importErrors}}
                        <tr>
                          <td>{{index}}</td>
                          <td>{{message}}
                          <td>{{row}}</td>
                        </tr>
                      {{/each}}
                    </tbody>
                  </table>
                </td>
              </tr>
            {{/if}}
          {{else}}
            <tr>
              <td colspan="5">No imports have been completed.</td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    {{/if}}
</fieldset>
</div>
