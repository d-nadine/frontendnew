<form {{bind-attr class="isExpandable isNew isEditable isExpanded justAdded :form :form-inline :meeting-form"}}>
  <div {{bind-attr class="isFinished view.isFocused showTopicTextBox:open:closed :primary"}} {{action "expand"}}>
    {{#if showComments}}
      <i class="ss-symbolicons-block ss-chat pull-right form-box-comments-icon"></i>
    {{/if}}

    {{#if showOptions}}
      <a tabindex="3" class="btn btn-link pull-right" {{action "toggleExpanded" bubbles=false}}>
        {{#if isExpanded}}
          Hide
        {{else}}
          Options
        {{/if}}
      </a>
    {{/if}}

    <div class="form-icon pull-left">
      <i class="ss-standard ss-calendar inline-form-icon"></i>
    </div>

    {{#if showSuccess}}
      <span class="success green pull-right">Meeting saved</span>
    {{/if}}

    {{#if showTopicTextBox}}
      {{view view.topicField classNames="field field-blend-in" viewName="topic"}}
    {{else}}
      <span class="topic">
        {{topic}} with
        {{#each attendees}}
          {{resource-link-to this}}
        {{/each}}
        at {{view.readableStartsAt}}
      </span>
    {{/if}}
  </div>

  {{#if isExpanded}}
    <div class="expanded-fields">
      <div class="form-row">
        <div class="field-group">
          {{date-picker date=startsAt leader='' class="field starts-at"}}
          {{view view.startsAt class="field"}} to {{view view.endsAt class="field"}}
        </div>
      </div>
      <div class="form-row">
        <div class="field-group">
          {{view view.location class="field"}}
        </div>
      </div>
      <div class="form-row">
        <div class="field-group">
          <label class="icon-label"><i class="ss-symbolicons-block ss-write"></i></label>
          <div class="field-group-input">
            {{input type="text" value=description class="input-block-level" placeholder="description" action="submit"}}
          </div>
          <div class="clearfix">
            <div class="pull-right">
              <i class="ss-standard ss-attach"></i>
              {{#if isNew}}
                {{file-uploader files=controller.files disableSave=disableSave bucket=bucket class="btn-file btn-messages-action"}}
              {{else}}
                {{file-uploader files=controller.files disableSave=disableSave model=model class="btn-file btn-messages-action"}}
              {{/if}}
            </div>
          </div>
        </div>
      </div>
      {{#if controller.files}}
        <div class="clearfix new-message-row">
          {{detailed-uploadfilelist files=controller.files}}
        </div>
      {{/if}}
      <div class="form-row">
        <div class="field-group meeting-form-invite">
          <div class="pull-right">
            <button class="btn btn-link" {{action "showCalendars"}}>
              {{formatDateTime startsAt format="calendar"}}'s Calendars
              <i {{bind-attr class=":ss-standard calendarsOpen:ss-navigateup:ss-navigatedown"}}></i>
            </button>
          </div>
          {{#unless isDisabled}}
            <label class="icon-label">
              <i class="ss-standard ss-user"></i>
            </label>
            <div>
              {{view view.attendees class="field" viewName="attendeeList"}}
            </div>
          {{/unless}}
        </div>
        {{#if attendees.length}}
          <div class="field-group meeting-form-attendees">
            <label class="icon-label">
              <i class="ss-standard ss-users"></i> Attendees
            </label>
            <ul class="unstyled meeting-form-attendees-list">
              {{each attendees itemViewClass="Radium.MeetingAttendeesView" itemController="meetingAttendeeItem"}}
            </ul>
          </div>
        {{/if}}
        {{#if calendarsOpen}}
          <div class="field-group">
            {{partial 'forms/existing_meetings'}}
          </div>
        {{/if}}
      </div>
      <div class="form-row form-buttons">
        {{#if showAddAction}}
          {{partial 'add_action'}}
        {{/if}}
        <div class="pull-right">
          <button class="btn btn-main" {{action "showCancelMeetingDialogue" target="view" bubbles=false}} {{bind-attr disabled="view.cancelMeetingDisabled"}}>Cancel Meeting</button>
          <button class="btn btn-main btn-primary" {{action "submit" bubbles=false}}>Save</button>
        </div>
      </div>

      {{partial 'forms/tasks'}}

      {{partial 'forms/footer'}}
    </div>
  {{/if}}
  {{view view.cancelMeetingDialogue}}
</form>
